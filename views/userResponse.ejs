<!DOCTYPE html>
<html>
  <head>
    <title>Response Form</title>
    <meta charset="UTF-8">
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <script type="text/javascript">
      function getQueryVariable(variable)
      {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
          var pair = vars[i].split("=");
          if(pair[0] == variable){return pair[1];}
        }
        return(false);
      }

      function isEmpty(str) {
        return (!str || 0 === str.length);
      }

      window.onload = function()
      {
        ticketID = getQueryVariable("id");
        if (ticketID == false) {
          var errTxt = "No ID in URL";
          document.getElementById("errorDiv").style.display = "block";
          document.getElementById("errorText").innerHTML = errTxt;
        } else {
          document.getElementById("ticketIdInput").value = ticketID;
        }

        console.log("hello");

        var historyStr = "<%= historyBlock %>";
        console.log("we got here: " + historyStr);
        if (isEmpty(historyStr)) {
          document.getElementById("historyDiv").innerHTML = "<p>No previous history</p>";
        } else {
          var paras = historyStr.split("*np*");
          for (var i=0;i<paras.length;i++) {
            document.getElementById("historyDiv").innerHTML = document.getElementById("historyDiv").innerHTML + "<p>" + paras[i] + "</p>";
          }
        }
      }
    </script>
  </head>


  <body>
    <div class="container">
      <div class="page-header">
        <h1>User Response <small>We are here to help</small></h1>
      </div>

      <div id="errorDiv" class="alert alert-danger" style="display: none">
        <strong id="errorText"></strong>
      </div>

      <p class="lead">Hi <%= name %>, we are sorry you are having a problem with "<%= title %>".</p>

      <form action="/response" enctype="application/x-www-form-urlencoded" method="post">
        <div class="form-group">
          <label for="exampleInputName1">Description of problem</label>
          <textarea class="form-control" name="description" rows="10" ></textarea>
        </div>
        <input id="ticketIdInput" type="hidden" name="ticketId" value="0">
        <input id="titleInput" type="hidden" name="title" value="<%= title %>">
        <button type="submit" class="btn btn-default">Submit</button>
      </form>
      <br/>
      <div id="historyDiv" class="lead"></div>
    </div>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  </body>
</html>
